"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6],{58006:function(e,s,t){t.d(s,{n:function(){return T}});var a=t(57437),l=t(2265),n=t(54887),r=t(33145),i=t(12381),c=t(79820),d=t(40279),o=t(75060),m=t(71837),x=t(23340),u=t(78705),h=t(53113),g=t(48736),f=t(29374),p=t(69658),j=t(99397),N=t(32489),b=t(51817),v=t(96362),y=t(18930);let w=e=>{switch(e){case"IMAGE":return(0,a.jsx)(h.Z,{className:"h-4 w-4"});case"DOCUMENT":return(0,a.jsx)(g.Z,{className:"h-4 w-4"});case"VIDEO":return(0,a.jsx)(f.Z,{className:"h-4 w-4"});default:return(0,a.jsx)(p.Z,{className:"h-4 w-4"})}};function C(e){let{allowedCategories:s,agentId:t,onAssetSelect:n,mode:r="manage",selectedAssetIds:o=[],onSelectionChange:h}=e,{toast:g}=(0,x.pm)(),[f,C]=(0,l.useState)([]),[E,S]=(0,l.useState)(!0),[k,Z]=(0,l.useState)(!1),[A,M]=(0,l.useState)(!1),[I,F]=(0,l.useState)(o),[L,O]=(0,l.useState)({name:"",description:"",category:"OTHER",url:""});(0,l.useEffect)(()=>{T()},[s,t]);let T=async()=>{try{S(!0);let e={};t&&(e.agentId=t);let a=await m.h.getAssets(e),l=a.data||a;s&&s.length>0&&(l=l.filter(e=>s.includes(e.category))),C(l)}catch(e){console.error("Failed to fetch assets:",e),g({title:"Error",description:"Failed to load assets",variant:"destructive"})}finally{S(!1)}},z=async()=>{if(!L.name.trim()||!L.url.trim()){g({title:"Validation Error",description:"Name and URL are required",variant:"destructive"});return}try{new URL(L.url)}catch(e){g({title:"Invalid URL",description:"Please enter a valid URL",variant:"destructive"});return}M(!0);try{let e=await m.h.createAsset({name:L.name.trim(),description:L.description.trim()||void 0,category:L.category,url:L.url.trim(),agentId:t||void 0}),s=e.data||e;C(e=>[s,...e]),O({name:"",description:"",category:"OTHER",url:""}),Z(!1),g({title:"Asset Added",description:"".concat(L.name," has been added")})}catch(e){console.error("Failed to create asset:",e),g({title:"Error",description:"Failed to create asset",variant:"destructive"})}finally{M(!1)}},D=async e=>{if(confirm("Are you sure you want to delete this asset?"))try{await m.h.deleteAsset(e),C(s=>s.filter(s=>s.id!==e)),F(s=>s.filter(s=>s!==e)),g({title:"Asset Deleted",description:"The asset has been removed"})}catch(e){console.error("Failed to delete asset:",e),g({title:"Error",description:"Failed to delete asset",variant:"destructive"})}},R=e=>{if("select"===r){let s=I.includes(e.id)?I.filter(s=>s!==e.id):[...I,e.id];F(s),null==h||h(s)}null==n||n(e)},U=s||["IMAGE","DOCUMENT","VIDEO","OTHER"];return(0,a.jsxs)("div",{className:"space-y-4",children:["manage"===r&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-slate-700",children:"Media Assets"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Pre-upload files your agent can send in messages"})]}),(0,a.jsxs)(i.z,{size:"sm",variant:"outline",onClick:()=>Z(!0),className:"text-teal-600 border-teal-200 hover:bg-teal-50",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 mr-1"}),"Add Asset"]})]}),k&&(0,a.jsxs)(c.Zb,{className:"border-teal-200",children:[(0,a.jsxs)(c.Ol,{className:"pb-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(c.ll,{className:"text-sm",children:"Add New Asset"}),(0,a.jsx)(i.z,{size:"sm",variant:"ghost",onClick:()=>Z(!1),children:(0,a.jsx)(N.Z,{className:"h-4 w-4"})})]}),(0,a.jsx)(c.SZ,{className:"text-xs",children:"Enter a publicly accessible URL. For S3/cloud storage, ensure the URL is public."})]}),(0,a.jsxs)(c.aY,{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("label",{htmlFor:"asset-name",className:"text-xs text-muted-foreground",children:"Name *"}),(0,a.jsx)(d.I,{id:"asset-name",placeholder:"e.g., Product Brochure",value:L.name,onChange:e=>O(s=>({...s,name:e.target.value})),className:"h-8 text-sm"})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("label",{htmlFor:"asset-category",className:"text-xs text-muted-foreground",children:"Category"}),(0,a.jsx)("select",{id:"asset-category",value:L.category,onChange:e=>O(s=>({...s,category:e.target.value})),className:"flex h-8 w-full rounded-md border border-input bg-background px-3 text-sm",children:U.map(e=>(0,a.jsx)("option",{value:e,children:u.Xg[e].label},e))})]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("label",{htmlFor:"asset-url",className:"text-xs text-muted-foreground",children:"URL *"}),(0,a.jsx)(d.I,{id:"asset-url",type:"url",placeholder:"https://example.com/file.pdf",value:L.url,onChange:e=>O(s=>({...s,url:e.target.value})),className:"h-8 text-sm"})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)("label",{htmlFor:"asset-description",className:"text-xs text-muted-foreground",children:"Description (helps agent know when to use it)"}),(0,a.jsx)("textarea",{id:"asset-description",placeholder:"e.g., Send this when customers ask about pricing",value:L.description,onChange:e=>O(s=>({...s,description:e.target.value})),className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm min-h-[60px] focus:outline-none focus:ring-2 focus:ring-teal-500"})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,a.jsx)(i.z,{size:"sm",variant:"ghost",onClick:()=>Z(!1),children:"Cancel"}),(0,a.jsx)(i.z,{size:"sm",onClick:z,disabled:A||!L.name.trim()||!L.url.trim(),className:"bg-teal-600 hover:bg-teal-700",children:A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{className:"h-3 w-3 mr-1 animate-spin"}),"Adding..."]}):"Add Asset"})]})]})]}),E?(0,a.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,a.jsx)(b.Z,{className:"h-5 w-5 animate-spin text-teal-600"})}):0===f.length?(0,a.jsxs)("div",{className:"text-center py-8 text-sm text-muted-foreground",children:[(0,a.jsx)(p.Z,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"No assets yet"}),"manage"===r&&(0,a.jsx)("p",{className:"text-xs mt-1",children:"Add your first asset to get started"})]}):(0,a.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,a.jsxs)("div",{onClick:()=>R(e),className:"\n                flex items-center gap-3 p-3 rounded-lg border transition-colors\n                ".concat("select"===r?"cursor-pointer hover:border-teal-300":"","\n                ").concat(I.includes(e.id)?"border-teal-500 bg-teal-50":"border-slate-200","\n              "),children:["select"===r&&(0,a.jsx)("input",{type:"checkbox",checked:I.includes(e.id),onChange:()=>R(e),className:"h-4 w-4 rounded border-gray-300 text-teal-600 focus:ring-teal-500"}),(0,a.jsx)("div",{className:"p-2 rounded-md ".concat(u.Xg[e.category].color),children:w(e.category)}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"font-medium text-sm text-slate-700 truncate",children:e.name}),(0,a.jsx)("span",{className:"text-xs px-1.5 py-0.5 rounded ".concat(u.Xg[e.category].color),children:u.Xg[e.category].label})]}),e.description&&(0,a.jsx)("p",{className:"text-xs text-muted-foreground truncate mt-0.5",children:e.description})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(i.z,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),window.open(e.url,"_blank")},className:"h-7 w-7 p-0",title:"Open URL",children:(0,a.jsx)(v.Z,{className:"h-3.5 w-3.5"})}),"manage"===r&&(0,a.jsx)(i.z,{size:"sm",variant:"ghost",onClick:s=>{s.stopPropagation(),D(e.id)},className:"h-7 w-7 p-0 text-red-500 hover:text-red-600 hover:bg-red-50",title:"Delete",children:(0,a.jsx)(y.Z,{className:"h-3.5 w-3.5"})})]})]},e.id))})]})}var E=t(53417),S=t(49322),k=t(82222),Z=t(40875),A=t(30401),M=t(76980),I=t(22135),F=t(44743);let L=e=>{if(!e)return null;let s=u.Cy.find(s=>s.id===e.toLowerCase());return(null==s?void 0:s.avatar)||null},O=e=>"MESSAGING_ONLY"===e||"OMNICHANNEL"===e;function T(e){let{agentId:s,agentName:t,imageToolEnabled:h=!1,documentToolEnabled:g=!1,videoToolEnabled:f=!1,onClose:p,onMessageSent:j}=e,{toast:v}=(0,x.pm)(),[y,w]=(0,l.useState)([]),[T,z]=(0,l.useState)(!s),[D,R]=(0,l.useState)(s?{id:s,name:t||"Agent",imageToolEnabled:h,documentToolEnabled:g,videoToolEnabled:f}:null),[U,_]=(0,l.useState)(""),[P,H]=(0,l.useState)(""),[G,X]=(0,l.useState)(""),[V,Y]=(0,l.useState)([]),[q,B]=(0,l.useState)(!1),[J,K]=(0,l.useState)(!1),[Q,W]=(0,l.useState)(!1),[$,ee]=(0,l.useState)(!1),es=(null==D?void 0:D.imageToolEnabled)||!1,et=(null==D?void 0:D.documentToolEnabled)||!1,ea=(null==D?void 0:D.videoToolEnabled)||!1,el=[];es&&el.push("IMAGE"),et&&el.push("DOCUMENT"),ea&&el.push("VIDEO"),(0,l.useEffect)(()=>{ee(!0)},[]),(0,l.useEffect)(()=>{s||en()},[s]);let en=async()=>{z(!0);try{let e=((await m.h.getAgents()).data||[]).filter(e=>O(e.communicationChannel));w(e)}catch(e){console.error("Failed to fetch agents:",e)}finally{z(!1)}},er=e=>{let s=e.replace(/\D/g,"");return s.length<=3?s:s.length<=6?"(".concat(s.slice(0,3),") ").concat(s.slice(3)):s.length<=10?"(".concat(s.slice(0,3),") ").concat(s.slice(3,6),"-").concat(s.slice(6)):"(".concat(s.slice(0,3),") ").concat(s.slice(3,6),"-").concat(s.slice(6,10))},ei=async()=>{if(!D){v({title:"Select an agent",description:"Please select an agent to send the message",variant:"destructive"});return}let e=U.replace(/\D/g,"");if(e.length<10){v({title:"Invalid phone number",description:"Please enter a valid 10-digit phone number",variant:"destructive"});return}if(!P.trim()){v({title:"Message required",description:"Please enter a message to send",variant:"destructive"});return}W(!0);try{let s=G.trim()?[G.trim()]:void 0,t=V.length>0?V:void 0,a=await m.h.sendMessage(D.id,"+1".concat(e),P,s,t),l=s&&s.length>0||t&&t.length>0;v({title:"\uD83D\uDCE8 Message Sent",description:"".concat(l?"MMS":"SMS"," sent to ").concat(U)}),j&&j(a.data),p()}catch(e){v({title:"Error",description:e instanceof m.M?e.message:"Failed to send message",variant:"destructive"})}finally{W(!1)}},ec=U.replace(/\D/g,""),ed=P.length,eo=Math.ceil(ed/160)||1;if(!$)return null;let em=(0,a.jsx)("div",{className:"fixed inset-0 z-[100] bg-black/50 flex items-center justify-center p-4",children:(0,a.jsxs)(c.Zb,{className:"w-full max-w-md max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(c.Ol,{className:"pb-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(E.Z,{className:"h-5 w-5 text-slate-600"}),(0,a.jsx)(c.ll,{className:"text-slate-600",children:"Send Message"})]}),(0,a.jsx)("button",{onClick:p,className:"text-muted-foreground hover:text-slate-600 transition-colors",children:(0,a.jsx)(N.Z,{className:"h-5 w-5"})})]}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Send a text message ",D&&(0,a.jsxs)(a.Fragment,{children:["as ",(0,a.jsx)("span",{className:"font-medium text-slate-600",children:D.name})]})]})]}),(0,a.jsxs)(c.aY,{className:"space-y-4",children:[!s&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{className:"text-muted-foreground",children:"Agent"}),T?(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 border rounded-md",children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 animate-spin text-teal-600"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Loading agents..."})]}):0===y.length?(0,a.jsx)("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 text-amber-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"text-sm text-amber-700",children:[(0,a.jsx)("p",{className:"font-medium",children:"No messaging agents"}),(0,a.jsx)("p",{className:"mt-0.5 text-xs",children:"Create an agent with Messaging or Omnichannel channel."})]})]})}):(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>K(!J),className:"w-full flex items-center gap-3 p-3 border rounded-md bg-white hover:bg-slate-50 transition-colors",children:[D?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden flex-shrink-0",children:L(D.voice)?(0,a.jsx)(r.default,{src:L(D.voice),alt:D.name,width:32,height:32,className:"w-full h-full object-cover"}):(0,a.jsx)(k.Z,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-slate-600 truncate text-sm",children:D.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"OMNICHANNEL"===D.communicationChannel?"Omnichannel":"Messaging"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center flex-shrink-0",children:(0,a.jsx)(k.Z,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Select an agent..."})]}),(0,a.jsx)(Z.Z,{className:"h-4 w-4 text-muted-foreground ml-auto transition-transform ".concat(J?"rotate-180":"")})]}),J&&(0,a.jsx)("div",{className:"absolute z-10 mt-1 w-full bg-white border rounded-md shadow-lg max-h-48 overflow-y-auto",children:y.map(e=>{let s=L(e.voice),t=(null==D?void 0:D.id)===e.id;return(0,a.jsxs)("button",{type:"button",onClick:()=>{R(e),K(!1)},className:"w-full flex items-center gap-3 p-3 hover:bg-slate-50 transition-colors ".concat(t?"bg-teal-50":""),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center overflow-hidden flex-shrink-0",children:s?(0,a.jsx)(r.default,{src:s,alt:e.name,width:32,height:32,className:"w-full h-full object-cover"}):(0,a.jsx)(k.Z,{className:"h-4 w-4 text-muted-foreground"})}),(0,a.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,a.jsx)("p",{className:"font-medium text-slate-600 truncate text-sm",children:e.name}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"OMNICHANNEL"===e.communicationChannel?"Omnichannel":"Messaging"})]}),t&&(0,a.jsx)(A.Z,{className:"h-4 w-4 text-teal-600 flex-shrink-0"})]},e.id)})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{htmlFor:"phone",className:"text-muted-foreground",children:"Phone Number"}),(0,a.jsx)(d.I,{id:"phone",type:"tel",placeholder:"(555) 123-4567",value:U,onChange:e=>{_(er(e.target.value))},className:"text-lg",disabled:!s&&!D})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(o._,{htmlFor:"message",className:"text-muted-foreground",children:"Message"}),(0,a.jsxs)("span",{className:"text-xs ".concat(ed>160?"text-amber-600":"text-muted-foreground"),children:[ed,"/160 ",eo>1&&"(".concat(eo," segments)")]})]}),(0,a.jsx)("textarea",{id:"message",placeholder:"Type your message...",value:P,onChange:e=>H(e.target.value),className:"w-full min-h-[100px] p-3 border rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-teal-500 disabled:bg-slate-50 disabled:text-muted-foreground",maxLength:1600,disabled:!s&&!D})]}),D&&(es||et||ea)&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("button",{type:"button",onClick:()=>B(!q),className:"flex items-center justify-between w-full text-sm text-teal-600 hover:text-teal-700 py-1",children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(M.Z,{className:"h-4 w-4"}),"Attach media ",(V.length>0||G.trim())&&(0,a.jsxs)("span",{className:"bg-teal-100 text-teal-700 px-1.5 py-0.5 rounded text-xs",children:[V.length+(G.trim()?1:0)," attached"]})]}),q?(0,a.jsx)(I.Z,{className:"h-4 w-4"}):(0,a.jsx)(Z.Z,{className:"h-4 w-4"})]}),q&&(0,a.jsxs)("div",{className:"space-y-3 p-3 bg-slate-50 rounded-md border",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(o._,{className:"text-xs text-muted-foreground",children:"Select from your assets"}),(0,a.jsx)(C,{mode:"select",allowedCategories:el,agentId:D.id,selectedAssetIds:V,onSelectionChange:Y})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,a.jsx)("span",{className:"w-full border-t"})}),(0,a.jsx)("div",{className:"relative flex justify-center text-xs uppercase",children:(0,a.jsx)("span",{className:"bg-slate-50 px-2 text-muted-foreground",children:"or enter URL"})})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsx)(d.I,{type:"url",placeholder:"https://example.com/file.pdf",value:G,onChange:e=>X(e.target.value),className:"text-sm h-8"}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Enter a publicly accessible URL to any"," ",el.map(e=>u.Xg[e].label.toLowerCase()).join(", ")]})]})]})]}),ed>160&&(0,a.jsxs)("div",{className:"flex items-start gap-2 p-2 bg-amber-50 border border-amber-200 rounded-md",children:[(0,a.jsx)(S.Z,{className:"h-4 w-4 text-amber-600 mt-0.5 flex-shrink-0"}),(0,a.jsx)("p",{className:"text-xs text-amber-700",children:"Messages over 160 characters are split into multiple segments, which may increase costs."})]}),(0,a.jsx)(i.z,{onClick:ei,disabled:Q||!D||ec.length<10||!P.trim(),className:"w-full bg-teal-600 hover:bg-teal-700",children:Q?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(b.Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F.Z,{className:"h-4 w-4 mr-2"}),"Send ",V.length>0||G.trim()?"MMS":"SMS"]})})]})]})});return(0,n.createPortal)(em,document.body)}},40279:function(e,s,t){t.d(s,{I:function(){return r}});var a=t(57437),l=t(2265),n=t(93448);let r=l.forwardRef((e,s)=>{let{className:t,type:l,...r}=e;return(0,a.jsx)("input",{type:l,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...r})});r.displayName="Input"},75060:function(e,s,t){t.d(s,{_:function(){return r}});var a=t(57437),l=t(2265),n=t(93448);let r=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("label",{ref:s,className:(0,n.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...l})});r.displayName="Label"}}]);